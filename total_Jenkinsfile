def sailfishNodeA(String c) {
	
		node ('Sailfish1'){ //Assigning the Node

			int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
			
				if (conta_Num == 0) {
				
					echo "no.of containers in Sailfish1 " + conta_Num
					
					cleanWs()        				
			
					deletingContainer ('Checking existence')   //Deleting the Conta if existed
			
					allStages('all the stages') 			      // calling the all stages 
				
				}
			}
		}
		
	def allStages(String a) {
	
      stage ('Spinnig Conta') {
			deletingContainer ('Checking existence')
			sh 'docker run -d --name qe1instance alpine'
      }
       stage ('Pull by commit') {
           sh 'docker ps -a'
       }
       stage ('Atc') {
           sh 'docker ps'
       }
       stage ('Security') {
           sh '''
           docker ps -a | grep 'alpine' | wc -l
           sleep 30
           '''
       }
        stage ('Security') {
           sh 'docker ps -a | grep seconds | wc -l'
       }
       stage ('Deleting Conta') {
           sh 'docker rm -f  qe1instance'
       }  
    }

def deletingContainer (String b) {
   sh '''
		x=$(docker ps -aq --filter "name=qe1instance" | grep -q .  && echo Found || echo Not Found)
  if [ $x=Found ]; 
  then 
     docker rm -f qe1instance
     sleep 15 
  else 
    echo 'container is not created' 
  fi
    '''
}

timestamps {

  node () {
	
	stage ('checking for Condition') {

	node ('Sailfish1') {
	
				int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
		
	 if (conta_Num == 0) {

				echo "no.of containers in Sailfish1 " + conta_Num
		    
				deletingContainer ('Checking existence')
		
				//If the condition is true so, coming out of the Sailfish1 node and getting in to Sailfish2
		
				echo 'starting the stages in Sailfish1, As no conta is spinned up'
				
				allStages('Calling allStages')
		
		} else { 
		
				echo 'getting in to Sailfish2 as there were some Contas are running in Sailfish1'
				
				sailfishNodeB('Calling theSail')
				
				echo '================================================================='
				
			      }       
		      }
       }
    }
	}
	
	
	def sailfishNodeB(String e) {
	
		node ('master'){  //Assigning the Node Master=Sailfish2
		
					int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
		
		if (conta_Num == 0) {  
		
					echo "no.of containers in Sailfish1 " + conta_Num
			
					cleanWs()
			
					deletingContainer ('Checking existence')   //Deleting the Conta if existed
			
					allStages('all the stages') 			      // calling the all stages 
			
		 }else {
		 
		 echo 'getting in to Sailfish1 as there were some Contas are running in Sailfish2'
			sleep 60                                    //waiting time is 3 minutes
			
			sailfishNodeA('Calling theSail')
			
		 }
		 
	 }
	
	}
