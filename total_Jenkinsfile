def sailfishNodeA(String c) {
			int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
				if (conta_Num == 0) {
				
					echo "no.of containers in Sailfish1 " + conta_Num
					
					cleanWs()
					
					node ('Sailfish1'){         				//Assigning the Node
			
					deletingContainer ('Checking existence')   //Deleting the Conta if existed
			
					allStages('all the stages') 			      // calling the all stages 
				
				}
			}else { 
				sleep 60
				sailfishNodeB('Calling theSail')
				
			}
		}
		//try to add the else condition in the above function too with sailfishNodeB inside in it lets see the resu;t
		
		
	def sailfishNodeB(String e) {
	
		node ('master'){
		int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
		if (conta_Num == 0) {  
		
				echo "no.of containers in Sailfish1 " + conta_Num
			
				cleanWs()
			
				         					//Assigning the Node Master
			
				deletingContainer ('Checking existence')   //Deleting the Conta if existed
			
				allStages('all the stages') 			      // calling the all stages 
			
		 }else {
		 
			sleep 60                                    //waiting time is 3 minutes
			
			sailfishNodeA('Calling theSail')
			
		 }
		 
	 }
	
	}
		
		
	def allStages(String a) {
	
      stage ('Spinnig Conta') {
			deletingContainer ('Checking existence')
			sh 'docker run -d --name qe1instance alpine'
      }
       stage ('Pull by commit') {
           sh 'docker ps -a'
       }
       stage ('Atc') {
           sh 'docker ps'
       }
       stage ('Security') {
           sh '''
           docker ps -a | grep 'alpine' | wc -l
           sleep 30
           '''
       }
        stage ('Security') {
           sh 'docker ps -a | grep seconds | wc -l'
       }
       stage ('Deleting Conta') {
           sh 'docker rm -f  qe1instance'
       }  
    }

def deletingContainer (String b) {
   sh '''
		x=$(docker ps -aq --filter "name=qe1instance" | grep -q .  && echo Found || echo Not Found)
  if [ $x=Found ]; 
  then 
     docker rm -f qe1instance
     sleep 15 
  else 
    echo 'container is not created' 
  fi
    '''
}


timestamps {

  node () {
	
	
	
    stage ('checking for Condition') {

	node ('Sailfish1') {
		int conta_Num = sh(returnStdout: true, script: 'docker ps -a| grep alpine | wc -l')
	 if (conta_Num == 0) {

				echo "no.of containers in Sailfish1 " + conta_Num
		    
				deletingContainer ('Checking existence')
		
				//If the condition is true so, coming out of the Sailfish1 node and getting in to Sailfish2
		
				echo 'starting the stages in Sailfish1, As no conta is spinned up'
				
				allStages('Calling allStages')
		
		} else { 
		
				sailfishNodeB('Calling the Stages')
				
			      }  
		        
		      }
           }
    }
	}
